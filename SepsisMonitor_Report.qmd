---
title: "Sepsis Monitor"
author: "Katherine Giorgio"
format: html
---

```{r setup}
library(tidyverse)
library(data.table) ## For the fread function
library(lubridate)
library(googledrive)
library(gt)
library(tictoc)

source("sepsis_monitor_functions.R")
```

```{r task2}
#| eval: false

### Task 1: Speed reading
# fread with 50 people (this is the function default) = 10.61 s
tic()
df <- makeSepsisDataset(n=50, read_fn="fread")
toc()

# read_delim with 50 people = 21.22 s
tic()
df <- makeSepsisDataset(n=50, read_fn="read_delim")
toc()

# fread with 100 people = 15.68 s
tic()
df <- makeSepsisDataset(n=100, read_fn="fread")
toc()

# read_delim with 100 people = 57.9 s
tic()
df <- makeSepsisDataset(n=100, read_fn="read_delim")
toc()

# fread with 500 people = 76.19 s
tic()
df <- makeSepsisDataset(n=500, read_fn="fread")
toc()

# read_delim with 500 people = "timeout was reached: [physionet.org] Connection timed out after 10007 milliseconds"
tic()
df <- makeSepsisDataset(n=500, read_fn="read_delim")
toc()
```

```{r task3}

### Uploading to Google Drive

# authenticating Google Drive connection ---- this doesn't seem to solve the problem... leaving it here for now though
#drive_auth(email = "giorg024@umn.edu",
 #          path = "C:\\Users\\kathe\\OneDrive\\Desktop\\04 Advanced R\\Code - Git\\7462-sepsis-monitor\\googledrive_apikey.txt")


df <- makeSepsisDataset()

# We have to write the file to disk first, then upload it
df %>% write_csv("sepsis_data_temp.csv")

# Uploading happens here
sepsis_file <- drive_put(media = "sepsis_data_temp.csv", 
          path = "https://drive.google.com/drive/folders/1bw6XgCMdGh1DyMIGOm1mPTTDP5rtny5W?usp=sharing",
          name = "sepsis_data.csv")

# Set the file permissions so anyone can download this file.
sepsis_file %>% drive_share_anyone()
```



```{r content}
CurrentSepsisTable <- df %>% 
  #filter(SepsisLabel == 1) %>% 
  select(c(PatientID, HR, Temp, Resp)) %>% 
  gt() %>% 
  tab_header(title = "Sepsis Patients' Current Status",
             subtitle = "data updated every hour") %>% 
  cols_label(PatientID = "Patient ID",
             HR = "Heart Rate",
             Temp = "Body Temperature",
             Resp = "Respirations") %>% 
  cols_align(align="center")

```


